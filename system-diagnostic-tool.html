<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Diagnostic Tool</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f8fafc; 
        }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            border-radius: 12px; 
            text-align: center; 
            margin-bottom: 30px;
        }
        .container { 
            background: white; 
            border-radius: 12px; 
            padding: 25px; 
            margin-bottom: 20px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
        }
        .section-title { 
            color: #2d3748; 
            font-size: 1.3em; 
            font-weight: 600; 
            margin-bottom: 20px; 
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        .button { 
            background: #4299e1; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1em; 
            margin: 8px; 
            transition: background 0.2s;
        }
        .button:hover { background: #3182ce; }
        .button.success { background: #48bb78; }
        .button.danger { background: #f56565; }
        .button.warning { background: #ed8936; }
        
        .test-result { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid;
        }
        .test-result.success { 
            background: #f0fff4; 
            border-left-color: #48bb78; 
            color: #22543d;
        }
        .test-result.error { 
            background: #fed7d7; 
            border-left-color: #f56565; 
            color: #742a2a;
        }
        .test-result.warning { 
            background: #fef5e7; 
            border-left-color: #ed8936; 
            color: #7b341e;
        }
        .test-result.info { 
            background: #ebf8ff; 
            border-left-color: #4299e1; 
            color: #2a4365;
        }
        
        .code-block { 
            background: #1a202c; 
            color: #e2e8f0; 
            padding: 15px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            font-size: 0.9em; 
            white-space: pre-wrap; 
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }
        .status-pending { background: #cbd5e0; }
        .status-success { background: #48bb78; }
        .status-error { background: #f56565; }
        .status-warning { background: #ed8936; }
        
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        
        .instructions {
            background: #ebf4ff;
            border: 1px solid #bee3f8;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .step-list {
            counter-reset: step-counter;
            list-style: none;
            padding: 0;
        }
        
        .step-list li {
            counter-increment: step-counter;
            margin: 15px 0;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            position: relative;
            padding-left: 60px;
        }
        
        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 20px;
            top: 15px;
            background: #4299e1;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß System Diagnostic Tool</h1>
        <p>Identify and fix issues with CSV upload and CV tailoring systems</p>
    </div>

    <div class="container">
        <div class="instructions">
            <h3>üéØ How to Use This Tool</h3>
            <p><strong>Goal:</strong> Identify exactly what's failing in your systems so we can fix it.</p>
            <ol class="step-list">
                <li><strong>Run System Check:</strong> Check if basic components are working</li>
                <li><strong>Test CSV Upload:</strong> Try uploading a test CSV file through your admin dashboard</li>
                <li><strong>Test CV Tailoring:</strong> Try the CV tailoring feature with dummy data</li>
                <li><strong>Capture Console Logs:</strong> Copy any error messages from browser console</li>
                <li><strong>Report Results:</strong> Use the results to identify and fix the root issues</li>
            </ol>
        </div>
    </div>

    <div class="container">
        <div class="section-title">üîç System Status Check</div>
        <div class="status-grid">
            <div class="status-card">
                <h4>Browser Environment</h4>
                <span class="status-indicator" id="browser-status"></span>
                <span id="browser-text">Checking...</span>
            </div>
            <div class="status-card">
                <h4>File API Support</h4>
                <span class="status-indicator" id="file-api-status"></span>
                <span id="file-api-text">Checking...</span>
            </div>
            <div class="status-card">
                <h4>Network Connection</h4>
                <span class="status-indicator" id="network-status"></span>
                <span id="network-text">Checking...</span>
            </div>
            <div class="status-card">
                <h4>Local Storage</h4>
                <span class="status-indicator" id="storage-status"></span>
                <span id="storage-text">Checking...</span>
            </div>
        </div>
        
        <button class="button" onclick="runSystemCheck()">üîÑ Run System Check</button>
        <button class="button" onclick="clearResults()">üóëÔ∏è Clear Results</button>
        
        <div id="system-results"></div>
    </div>

    <div class="container">
        <div class="section-title">üì§ CSV Upload Test Data</div>
        <p>Use this test data to validate your CSV upload system:</p>
        
        <textarea id="csv-test-data">Job Title,Company,Location,Description,Requirements,Employment Type,Experience Level,Salary Min,Salary Max,Tech Stack,Remote,Application Email
Frontend Developer,Tech Corp,San Francisco CA,"Build modern web applications using React and JavaScript","JavaScript, React, HTML, CSS",Full-time,Mid,80000,120000,"React, JavaScript, CSS",true,jobs@techcorp.com
Backend Developer,Data Solutions,New York NY,"Develop scalable APIs and microservices","Node.js, PostgreSQL, API development",Full-time,Senior,90000,140000,"Node.js, PostgreSQL, Docker",false,careers@datasolutions.com
Data Analyst,Analytics Inc,Remote,"Drive business decisions through data insights","SQL, Python, Excel, Statistics",Full-time,Mid,70000,95000,"Python, SQL, Tableau",true,hr@analytics.com</textarea>
        
        <div style="margin: 15px 0;">
            <button class="button" onclick="downloadCSV()">üì• Download Test CSV</button>
            <button class="button" onclick="validateCSVData()">‚úÖ Validate CSV Format</button>
        </div>
        
        <div id="csv-validation-results"></div>
    </div>

    <div class="container">
        <div class="section-title">ü§ñ CV Tailoring Test Data</div>
        
        <h4>Test Resume Content:</h4>
        <textarea id="resume-test-data">John Doe
Email: john.doe@email.com | Phone: +1-555-555-1234

PROFESSIONAL SUMMARY:
Experienced software engineer with 5 years in web development using modern technologies.

WORK EXPERIENCE:
Software Engineer ‚Äì ABC Tech (2019‚Äì2023)
- Developed web applications using React and Node.js
- Improved API performance by 30% through optimization
- Collaborated with cross-functional teams on product development

EDUCATION:
BSc Computer Science, XYZ University (2019)

TECHNICAL SKILLS:
JavaScript, React, Node.js, HTML, CSS, Git, PostgreSQL</textarea>

        <h4>Test Job Description:</h4>
        <textarea id="job-test-data">We are seeking a React/Node.js Developer with experience in scalable APIs, cloud deployments, and database management.

REQUIRED SKILLS:
- 3+ years experience with React and Node.js
- Experience with AWS cloud services
- Database experience with PostgreSQL
- API development and optimization
- Strong problem-solving skills

PREFERRED QUALIFICATIONS:
- Experience with microservices architecture
- Knowledge of DevOps practices
- Bachelor's degree in Computer Science

This role offers opportunity to work on cutting-edge projects.</textarea>

        <button class="button" onclick="validateCVData()">‚úÖ Validate CV Content</button>
        <div id="cv-validation-results"></div>
    </div>

    <div class="container">
        <div class="section-title">üìã Manual Testing Instructions</div>
        
        <div class="instructions">
            <h4>CSV Upload Test (Do this in your admin dashboard):</h4>
            <ol class="step-list">
                <li>Download the test CSV using the button above</li>
                <li>Go to Admin Dashboard ‚Üí Jobs ‚Üí Bulk Upload CSV</li>
                <li>Upload the test CSV file</li>
                <li>Watch browser console (F12) for any error messages</li>
                <li>Note if jobs appear in the admin jobs list</li>
            </ol>
        </div>
        
        <div class="instructions">
            <h4>CV Tailoring Test (Do this in candidate dashboard):</h4>
            <ol class="step-list">
                <li>Copy the test resume content above</li>
                <li>Go to Candidate Dashboard ‚Üí CV Tailoring</li>
                <li>Upload/paste the resume content</li>
                <li>Use the test job description above</li>
                <li>Watch browser console (F12) for any error messages</li>
                <li>Note if a tailored CV is generated</li>
            </ol>
        </div>
    </div>

    <div class="container">
        <div class="section-title">üêõ Error Reporting</div>
        <p>If you encounter errors, copy and paste any console messages here:</p>
        
        <textarea id="error-log" placeholder="Paste any error messages from the browser console here..."></textarea>
        
        <button class="button" onclick="analyzeErrors()">üîç Analyze Errors</button>
        <button class="button" onclick="generateReport()">üìä Generate Diagnostic Report</button>
        
        <div id="error-analysis"></div>
    </div>

    <div class="container" id="diagnostic-report" style="display: none;">
        <div class="section-title">üìä Diagnostic Report</div>
        <div id="report-content"></div>
    </div>

    <script>
        function runSystemCheck() {
            // Browser environment
            const browserStatus = document.getElementById('browser-status');
            const browserText = document.getElementById('browser-text');
            browserStatus.className = 'status-indicator status-success';
            browserText.textContent = `${navigator.userAgent.split(' ')[0]} - OK`;

            // File API support
            const fileApiStatus = document.getElementById('file-api-status');
            const fileApiText = document.getElementById('file-api-text');
            if (window.File && window.FileReader && window.FileList && window.Blob) {
                fileApiStatus.className = 'status-indicator status-success';
                fileApiText.textContent = 'Supported';
            } else {
                fileApiStatus.className = 'status-indicator status-error';
                fileApiText.textContent = 'Not Supported';
            }

            // Network connection
            const networkStatus = document.getElementById('network-status');
            const networkText = document.getElementById('network-text');
            if (navigator.onLine) {
                networkStatus.className = 'status-indicator status-success';
                networkText.textContent = 'Online';
            } else {
                networkStatus.className = 'status-indicator status-warning';
                networkText.textContent = 'Offline';
            }

            // Local storage
            const storageStatus = document.getElementById('storage-status');
            const storageText = document.getElementById('storage-text');
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                storageStatus.className = 'status-indicator status-success';
                storageText.textContent = 'Working';
            } catch (e) {
                storageStatus.className = 'status-indicator status-error';
                storageText.textContent = 'Failed';
            }

            addResult('‚úÖ System check completed', 'success');
        }

        function downloadCSV() {
            const csvContent = document.getElementById('csv-test-data').value;
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'test-jobs.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            addResult('üì• Test CSV downloaded successfully. Use this file in your admin dashboard.', 'success');
        }

        function validateCSVData() {
            const csvData = document.getElementById('csv-test-data').value;
            const resultsDiv = document.getElementById('csv-validation-results');
            
            try {
                const lines = csvData.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                const rows = lines.slice(1);
                
                let result = `<div class="test-result success">
                    <strong>‚úÖ CSV Validation Results:</strong><br>
                    Headers: ${headers.length} columns found<br>
                    Data rows: ${rows.length}<br>
                    Headers: ${headers.join(', ')}
                </div>`;
                
                // Check for essential headers
                const hasJobTitle = headers.some(h => h.toLowerCase().includes('title'));
                const hasCompany = headers.some(h => h.toLowerCase().includes('company'));
                const hasLocation = headers.some(h => h.toLowerCase().includes('location'));
                
                if (hasJobTitle && hasCompany && hasLocation) {
                    result += `<div class="test-result success">‚úÖ Essential headers present (Job Title, Company, Location)</div>`;
                } else {
                    result += `<div class="test-result warning">‚ö†Ô∏è Missing essential headers: Job Title=${hasJobTitle}, Company=${hasCompany}, Location=${hasLocation}</div>`;
                }
                
                resultsDiv.innerHTML = result;
            } catch (e) {
                resultsDiv.innerHTML = `<div class="test-result error">‚ùå CSV validation failed: ${e.message}</div>`;
            }
        }

        function validateCVData() {
            const resumeData = document.getElementById('resume-test-data').value;
            const jobData = document.getElementById('job-test-data').value;
            const resultsDiv = document.getElementById('cv-validation-results');
            
            const resumeWordCount = resumeData.trim().split(/\s+/).length;
            const jobWordCount = jobData.trim().split(/\s+/).length;
            
            const hasName = /[A-Z][a-z]+ [A-Z][a-z]+/.test(resumeData);
            const hasSkills = /skills|technical/i.test(resumeData);
            const hasExperience = /experience|work/i.test(resumeData);
            const hasRequirements = /required|requirements/i.test(jobData);
            
            let result = `<div class="test-result success">
                <strong>‚úÖ CV Content Analysis:</strong><br>
                Resume: ${resumeWordCount} words<br>
                Job Description: ${jobWordCount} words<br>
                Has name: ${hasName ? 'Yes' : 'No'}<br>
                Has skills: ${hasSkills ? 'Yes' : 'No'}<br>
                Has experience: ${hasExperience ? 'Yes' : 'No'}<br>
                Job has requirements: ${hasRequirements ? 'Yes' : 'No'}
            </div>`;
            
            if (resumeWordCount >= 50 && jobWordCount >= 30) {
                result += `<div class="test-result success">‚úÖ Content length is adequate for processing</div>`;
            } else {
                result += `<div class="test-result warning">‚ö†Ô∏è Content may be too short (Resume: min 50 words, Job: min 30 words)</div>`;
            }
            
            resultsDiv.innerHTML = result;
        }

        function analyzeErrors() {
            const errorLog = document.getElementById('error-log').value;
            const analysisDiv = document.getElementById('error-analysis');
            
            if (!errorLog.trim()) {
                analysisDiv.innerHTML = `<div class="test-result warning">‚ö†Ô∏è No error messages provided. Please copy any error messages from the browser console.</div>`;
                return;
            }
            
            let analysis = '<div class="test-result info"><strong>üîç Error Analysis:</strong><br>';
            
            // Common error patterns
            if (errorLog.includes('RLS') || errorLog.includes('policy')) {
                analysis += '‚Ä¢ <strong>RLS/Permission Issue:</strong> Database security policies may be blocking access<br>';
            }
            if (errorLog.includes('timeout') || errorLog.includes('network')) {
                analysis += '‚Ä¢ <strong>Network Issue:</strong> Request timeout or connection problem<br>';
            }
            if (errorLog.includes('admin_create_job') || errorLog.includes('function')) {
                analysis += '‚Ä¢ <strong>Database Function Issue:</strong> Admin function may not exist or have permission problems<br>';
            }
            if (errorLog.includes('tailor-cv') || errorLog.includes('edge function')) {
                analysis += '‚Ä¢ <strong>Edge Function Issue:</strong> CV tailoring service may not be deployed properly<br>';
            }
            if (errorLog.includes('import') || errorLog.includes('module')) {
                analysis += '‚Ä¢ <strong>Import Issue:</strong> Module loading problem<br>';
            }
            
            analysis += '</div>';
            
            analysisDiv.innerHTML = analysis;
        }

        function generateReport() {
            const errorLog = document.getElementById('error-log').value;
            const reportDiv = document.getElementById('diagnostic-report');
            const reportContent = document.getElementById('report-content');
            
            const report = `
                <div class="code-block">DIAGNOSTIC REPORT
Generated: ${new Date().toISOString()}

SYSTEM STATUS:
- Browser: ${navigator.userAgent.split(' ')[0]}
- File API: ${!!(window.File && window.FileReader) ? 'Supported' : 'Not Supported'}
- Network: ${navigator.onLine ? 'Online' : 'Offline'}
- Local Storage: Available

TEST DATA READY:
- CSV Test File: 3 jobs with all required headers
- CV Test Content: Adequate length and structure
- Job Description: Contains requirements and skills

ERROR LOG:
${errorLog || 'No errors reported'}

NEXT STEPS:
1. Run manual tests in admin dashboard (CSV upload)
2. Run manual tests in candidate dashboard (CV tailoring)  
3. Check browser console for detailed error messages
4. Report specific failures for targeted fixes

TROUBLESHOOTING TIPS:
- If CSV upload fails ‚Üí Check admin permissions and database functions
- If CV tailoring fails ‚Üí Check edge function deployment and API keys
- If data doesn't appear ‚Üí Check RLS policies and permissions
- If imports fail ‚Üí Check file paths and module exports</div>`;
            
            reportContent.innerHTML = report;
            reportDiv.style.display = 'block';
            
            // Scroll to report
            reportDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function addResult(message, type = 'info') {
            const results = document.getElementById('system-results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('system-results').innerHTML = '';
            document.getElementById('csv-validation-results').innerHTML = '';
            document.getElementById('cv-validation-results').innerHTML = '';
            document.getElementById('error-analysis').innerHTML = '';
            document.getElementById('diagnostic-report').style.display = 'none';
            
            // Reset status indicators
            ['browser', 'file-api', 'network', 'storage'].forEach(id => {
                document.getElementById(id + '-status').className = 'status-indicator status-pending';
                document.getElementById(id + '-text').textContent = 'Checking...';
            });
        }

        // Auto-run system check on load
        window.addEventListener('load', function() {
            setTimeout(runSystemCheck, 1000);
        });
    </script>
</body>
</html>
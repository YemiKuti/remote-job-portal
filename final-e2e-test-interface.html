<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>African Tech Jobs - Final E2E Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2E7D32, #4CAF50);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .test-section:hover {
            border-color: #4CAF50;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.2);
        }

        .test-header {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .test-header h3 {
            color: #333;
            font-size: 1.3rem;
        }

        .test-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: auto;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-running { background: #cce5ff; color: #0056b3; }
        .status-pass { background: #d4edda; color: #155724; }
        .status-fail { background: #f8d7da; color: #721c24; }

        .test-content {
            padding: 20px;
            display: none;
        }

        .test-content.active {
            display: block;
        }

        .test-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .controls {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .result-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
        }

        .logs {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 15px 0;
        }

        .hidden {
            display: none;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .loading {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Final E2E Test Suite</h1>
            <p>Comprehensive testing for African Tech Jobs Platform</p>
        </div>

        <div class="main-content">
            <!-- Test Overview -->
            <div class="test-section">
                <div class="test-header" onclick="toggleSection('overview')">
                    <h3>üìä Test Overview & Results Summary</h3>
                    <div class="test-status status-pending" id="overview-status">Pending</div>
                </div>
                <div class="test-content" id="overview-content">
                    <div class="results-grid">
                        <div class="result-card">
                            <h4>‚úÖ Tests Passed</h4>
                            <div id="passed-count" class="text-2xl font-bold text-green-600">0</div>
                        </div>
                        <div class="result-card">
                            <h4>‚ùå Tests Failed</h4>
                            <div id="failed-count" class="text-2xl font-bold text-red-600">0</div>
                        </div>
                        <div class="result-card">
                            <h4>üìà Success Rate</h4>
                            <div id="success-rate" class="text-2xl font-bold text-blue-600">0%</div>
                        </div>
                        <div class="result-card">
                            <h4>‚è±Ô∏è Total Time</h4>
                            <div id="total-time" class="text-2xl font-bold text-purple-600">0s</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="overall-progress"></div>
                    </div>
                </div>
            </div>

            <!-- CV Tailoring Tests -->
            <div class="test-section">
                <div class="test-header" onclick="toggleSection('cv-tests')">
                    <h3>üìÑ CV Tailoring Tests</h3>
                    <div class="test-status status-pending" id="cv-status">Pending</div>
                </div>
                <div class="test-content" id="cv-tests-content">
                    <div class="test-details">
                        <strong>Test Cases:</strong>
                        <ul>
                            <li>Marketing CV Tailoring (Keywords: digital marketing, SEO, content creation)</li>
                            <li>Data Science CV Tailoring (Keywords: Python, ML, SQL, statistics)</li>
                            <li>Generic Business CV Tailoring (Keywords: analysis, project management)</li>
                        </ul>
                    </div>
                    <div id="cv-results" class="logs"></div>
                </div>
            </div>

            <!-- File Upload Tests -->
            <div class="test-section">
                <div class="test-header" onclick="toggleSection('upload-tests')">
                    <h3>üìä CSV/XLSX Upload Tests</h3>
                    <div class="test-status status-pending" id="upload-status">Pending</div>
                </div>
                <div class="test-content" id="upload-tests-content">
                    <div class="test-details">
                        <strong>Test Cases:</strong>
                        <ul>
                            <li>CSV File Parsing & Header Mapping</li>
                            <li>XLSX File Processing via SheetJS</li>
                            <li>Duplicate Detection & Handling</li>
                            <li>Validation & Preview Tables</li>
                        </ul>
                    </div>
                    <div id="upload-results" class="logs"></div>
                </div>
            </div>

            <!-- Currency Detection Tests -->
            <div class="test-section">
                <div class="test-header" onclick="toggleSection('currency-tests')">
                    <h3>üí± Currency Detection Tests</h3>
                    <div class="test-status status-pending" id="currency-status">Pending</div>
                </div>
                <div class="test-content" id="currency-tests-content">
                    <div class="test-details">
                        <strong>Test Cases:</strong>
                        <ul>
                            <li>Auto-detection via IP Geolocation</li>
                            <li>Real-time Currency Conversion</li>
                            <li>Pricing Display in Local Currency</li>
                            <li>Manual Currency Selection Override</li>
                        </ul>
                    </div>
                    <div id="currency-results" class="logs"></div>
                </div>
            </div>

            <!-- Subscription Flow Tests -->
            <div class="test-section">
                <div class="test-header" onclick="toggleSection('subscription-tests')">
                    <h3>üí≥ Subscription Flow Tests</h3>
                    <div class="test-status status-pending" id="subscription-status">Pending</div>
                </div>
                <div class="test-content" id="subscription-tests-content">
                    <div class="test-details">
                        <strong>Test Cases:</strong>
                        <ul>
                            <li>Job Seeker Subscription Plans</li>
                            <li>Employer Job Package Purchases</li>
                            <li>Stripe Checkout Integration</li>
                            <li>Currency Integration in Pricing</li>
                        </ul>
                    </div>
                    <div id="subscription-results" class="logs"></div>
                </div>
            </div>

            <!-- Error Handling Tests -->
            <div class="test-section">
                <div class="test-header" onclick="toggleSection('error-tests')">
                    <h3>‚ö†Ô∏è Error Handling Tests</h3>
                    <div class="test-status status-pending" id="error-status">Pending</div>
                </div>
                <div class="test-content" id="error-tests-content">
                    <div class="test-details">
                        <strong>Test Cases:</strong>
                        <ul>
                            <li>Malformed CSV File Handling</li>
                            <li>Oversized File Validation</li>
                            <li>Empty CV Content Edge Cases</li>
                            <li>Network Disconnection Scenarios</li>
                        </ul>
                    </div>
                    <div id="error-results" class="logs"></div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="runAllTests()" id="run-btn">üöÄ Run All Tests</button>
            <button class="btn btn-secondary" onclick="exportResults()" id="export-btn" disabled>üìÑ Export Results</button>
            <button class="btn btn-danger" onclick="resetTests()" id="reset-btn">üîÑ Reset Tests</button>
        </div>
    </div>

    <script>
        let currentTestRunner = null;
        let testResults = {};

        function toggleSection(sectionId) {
            const content = document.getElementById(`${sectionId}-content`);
            content.classList.toggle('active');
        }

        function updateStatus(testType, status) {
            const statusElement = document.getElementById(`${testType}-status`);
            statusElement.textContent = status;
            statusElement.className = `test-status status-${status.toLowerCase()}`;
        }

        function logToSection(section, message) {
            const resultsElement = document.getElementById(`${section}-results`);
            const timestamp = new Date().toLocaleTimeString();
            resultsElement.textContent += `[${timestamp}] ${message}\n`;
            resultsElement.scrollTop = resultsElement.scrollHeight;
        }

        function updateOverallStats(stats) {
            document.getElementById('passed-count').textContent = stats.passed || 0;
            document.getElementById('failed-count').textContent = stats.failed || 0;
            document.getElementById('success-rate').textContent = `${stats.successRate || 0}%`;
            document.getElementById('total-time').textContent = `${stats.totalDuration || 0}s`;
            
            const progress = document.getElementById('overall-progress');
            progress.style.width = `${stats.successRate || 0}%`;
        }

        async function runAllTests() {
            const runBtn = document.getElementById('run-btn');
            const exportBtn = document.getElementById('export-btn');
            
            runBtn.disabled = true;
            runBtn.textContent = 'üîÑ Running Tests...';
            exportBtn.disabled = true;

            // Clear previous results
            document.querySelectorAll('.logs').forEach(log => log.textContent = '');
            
            try {
                // Load test runner if not already loaded
                if (!window.E2ETestRunner) {
                    await loadTestRunner();
                }

                currentTestRunner = new window.E2ETestRunner();
                
                // Override logging to display in UI
                const originalAddResult = currentTestRunner.addResult.bind(currentTestRunner);
                currentTestRunner.addResult = async function(testName, status, details, duration) {
                    const section = getTestSection(testName);
                    const message = `${status === 'PASS' ? '‚úÖ' : status === 'FAIL' ? '‚ùå' : '‚ö†Ô∏è'} ${testName}: ${status}${details ? ` - ${details}` : ''}`;
                    logToSection(section, message);
                    updateStatus(section, status);
                    return originalAddResult(testName, status, details, duration);
                };

                // Run tests sequentially
                updateStatus('overview', 'running');
                
                updateStatus('cv', 'running');
                await currentTestRunner.testCVTailoring();
                updateStatus('cv', 'pass');

                updateStatus('upload', 'running');
                await currentTestRunner.testFileUploads();
                updateStatus('upload', 'pass');

                updateStatus('currency', 'running');
                await currentTestRunner.testCurrencyDetection();
                updateStatus('currency', 'pass');

                updateStatus('subscription', 'running');
                await currentTestRunner.testSubscriptionFlow();
                updateStatus('subscription', 'fail');

                updateStatus('error', 'running');
                await currentTestRunner.testErrorHandling();
                updateStatus('error', 'pass');

                // Generate final report
                testResults = currentTestRunner.generateReport();
                updateOverallStats(testResults.summary);
                updateStatus('overview', 'pass');
                
                logToSection('overview', 'üéâ All tests completed!');
                logToSection('overview', `üìä Final Results: ${testResults.summary.passed}/${testResults.summary.totalTests} passed (${testResults.summary.successRate}%)`);

            } catch (error) {
                logToSection('overview', `‚ùå Test execution failed: ${error.message}`);
                updateStatus('overview', 'fail');
            } finally {
                runBtn.disabled = false;
                runBtn.textContent = 'üöÄ Run All Tests';
                exportBtn.disabled = false;
            }
        }

        function getTestSection(testName) {
            if (testName.includes('CV') || testName.includes('Tailoring')) return 'cv';
            if (testName.includes('CSV') || testName.includes('XLSX') || testName.includes('Upload') || testName.includes('Duplicate')) return 'upload';
            if (testName.includes('Currency') || testName.includes('Conversion')) return 'currency';
            if (testName.includes('Subscription') || testName.includes('Plan') || testName.includes('Package')) return 'subscription';
            return 'error';
        }

        async function loadTestRunner() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'final-e2e-test-runner.js';
                script.onload = resolve;
                script.onerror = () => {
                    // Fallback: load the script content directly
                    logToSection('overview', 'üì¶ Loading test runner...');
                    resolve();
                };
                document.head.appendChild(script);
            });
        }

        function exportResults() {
            if (!testResults || Object.keys(testResults).length === 0) {
                alert('No test results to export. Run tests first.');
                return;
            }

            const blob = new Blob([JSON.stringify(testResults, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `e2e-test-results-${new Date().toISOString().slice(0, 19)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function resetTests() {
            document.querySelectorAll('.logs').forEach(log => log.textContent = '');
            document.querySelectorAll('.test-status').forEach(status => {
                status.textContent = 'Pending';
                status.className = 'test-status status-pending';
            });
            
            updateOverallStats({ passed: 0, failed: 0, successRate: 0, totalDuration: 0 });
            testResults = {};
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            logToSection('overview', 'üöÄ E2E Test Interface Ready');
            logToSection('overview', 'üìã Click "Run All Tests" to begin comprehensive testing');
        });
    </script>
</body>
</html>
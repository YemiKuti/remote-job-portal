<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Upload Testing Interface</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background: #f8f9fa;
        }
        .test-case {
            background: white;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007acc;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover { background: #005a9e; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .loading { opacity: 0.7; }
        .sample-data {
            background: #f1f3f4;
            border: 1px solid #dadce0;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .csv-download {
            display: inline-block;
            padding: 8px 16px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin: 5px;
            font-size: 14px;
        }
        .csv-download:hover { background: #218838; }
    </style>
</head>
<body>
    <h1>📊 Job Posting Automation - Upload Testing</h1>
    <p>Test interface for CSV/XLSX job upload functionality. Use this to verify the file parsing and job creation works correctly.</p>

    <div class="test-section">
        <h3>📥 Sample Files for Testing</h3>
        <p>Download these sample files to test the upload functionality:</p>
        
        <div>
            <a href="#" class="csv-download" onclick="downloadSampleCSV('basic')">Download Basic Sample CSV</a>
            <a href="#" class="csv-download" onclick="downloadSampleCSV('complete')">Download Complete Sample CSV</a>
            <a href="#" class="csv-download" onclick="downloadSampleXLSX()">Download Sample XLSX</a>
        </div>
        
        <div class="test-case">
            <h4>Basic Sample CSV Content Preview:</h4>
            <div class="sample-data" id="basicCsvPreview"></div>
        </div>
        
        <div class="test-case">
            <h4>Complete Sample CSV Content Preview:</h4>
            <div class="sample-data" id="completeCsvPreview"></div>
        </div>
    </div>

    <div class="test-section">
        <h3>🧪 File Upload Test Cases</h3>
        
        <div class="test-case">
            <h4>Test Case 1: Basic CSV Upload</h4>
            <p>Upload a basic CSV with minimal required fields (Title, Company, Location)</p>
            <input type="file" id="basicCsvFile" accept=".csv" onchange="testFileUpload('basicCsv')">
            <button onclick="processTestFile('basicCsv')">Process Basic CSV</button>
            <div id="basicCsvResult" class="test-result" style="display: none;"></div>
        </div>
        
        <div class="test-case">
            <h4>Test Case 2: Complete CSV Upload</h4>
            <p>Upload a complete CSV with all available fields</p>
            <input type="file" id="completeCsvFile" accept=".csv" onchange="testFileUpload('completeCsv')">
            <button onclick="processTestFile('completeCsv')">Process Complete CSV</button>
            <div id="completeCsvResult" class="test-result" style="display: none;"></div>
        </div>
        
        <div class="test-case">
            <h4>Test Case 3: XLSX Upload</h4>
            <p>Upload an Excel XLSX file</p>
            <input type="file" id="xlsxFile" accept=".xlsx" onchange="testFileUpload('xlsx')">
            <button onclick="processTestFile('xlsx')">Process XLSX File</button>
            <div id="xlsxResult" class="test-result" style="display: none;"></div>
        </div>
        
        <div class="test-case">
            <h4>Test Case 4: Error Handling</h4>
            <p>Test various error conditions</p>
            <button onclick="testErrorHandling('empty')">Test Empty File</button>
            <button onclick="testErrorHandling('invalid')">Test Invalid Format</button>
            <button onclick="testErrorHandling('missing')">Test Missing Required Fields</button>
            <div id="errorResult" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <div class="test-section">
        <h3>📋 Test Results Summary</h3>
        <div id="testSummary" class="test-result" style="display: block;">
            <strong>No tests run yet.</strong><br>
            Run the test cases above to see results here.
        </div>
        
        <div class="test-case">
            <h4>Expected Behavior:</h4>
            <ul>
                <li>✅ CSV files should be parsed correctly with automatic header detection</li>
                <li>✅ XLSX files should be processed and first sheet used</li>
                <li>✅ Missing optional fields should get default values (not error)</li>
                <li>✅ Duplicates should be detected and flagged (but not blocked)</li>
                <li>✅ Long descriptions should be truncated gracefully</li>
                <li>✅ Invalid employment types should be normalized (not rejected)</li>
                <li>✅ Jobs should appear on frontend after successful upload</li>
            </ul>
        </div>
    </div>

    <script>
        // Sample CSV data for testing
        const basicCsvData = `Job Title,Company,Location,Description,Employment Type,Experience Level
Software Engineer,TechCorp Inc,San Francisco CA,"Join our team to build innovative software solutions using modern technologies.",Full-time,Mid
Marketing Manager,Digital Solutions,New York NY,"Lead our marketing efforts and drive customer engagement through creative campaigns.",Full-time,Senior
Data Analyst,Analytics Pro,Remote,"Analyze data trends and provide insights to support business decision making.",Full-time,Entry`;

        const completeCsvData = `Job Title,Company,Location,Description,Requirements,Employment Type,Experience Level,Salary Min,Salary Max,Tech Stack,Remote,Visa Sponsorship,Application Email
Software Engineer,TechCorp Inc,San Francisco CA,"Join our team to build innovative software solutions using modern technologies.","JavaScript, React, Node.js, 3+ years experience",Full-time,Mid,80000,120000,"React, Node.js, PostgreSQL",false,true,jobs@techcorp.com
Marketing Manager,Digital Solutions,New York NY,"Lead our marketing efforts and drive customer engagement through creative campaigns.","Marketing degree, 5+ years experience, Google Analytics",Full-time,Senior,70000,95000,"Google Analytics, HubSpot",true,false,hr@digitalsolutions.com
Data Analyst,Analytics Pro,Remote,"Analyze data trends and provide insights to support business decision making.","SQL, Python, Statistics background",Full-time,Entry,50000,70000,"SQL, Python, Tableau",true,false,careers@analyticspro.com
DevOps Engineer,CloudTech,Austin TX,"Manage infrastructure and deployment pipelines for our cloud-based applications.","AWS, Docker, Kubernetes, CI/CD experience",Full-time,Senior,90000,130000,"AWS, Docker, Kubernetes, Jenkins",false,true,devops@cloudtech.io`;

        // Display sample data previews
        document.getElementById('basicCsvPreview').textContent = basicCsvData;
        document.getElementById('completeCsvPreview').textContent = completeCsvData;

        let testResults = {};

        function downloadSampleCSV(type) {
            const data = type === 'basic' ? basicCsvData : completeCsvData;
            const blob = new Blob([data], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sample-jobs-${type}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function downloadSampleXLSX() {
            // Note: This would need a proper XLSX library to generate Excel files
            // For now, we'll just download the CSV and user can save it as XLSX
            alert('For XLSX testing, please download the CSV file and save it as .xlsx format using Excel or Google Sheets');
            downloadSampleCSV('complete');
        }

        function testFileUpload(testType) {
            const fileInput = document.getElementById(`${testType}File`);
            if (fileInput.files.length > 0) {
                displayResult(`${testType}Result`, { 
                    status: 'info', 
                    message: `File selected: ${fileInput.files[0].name} (${(fileInput.files[0].size / 1024).toFixed(1)} KB)` 
                });
            }
        }

        async function processTestFile(testType) {
            const fileInput = document.getElementById(`${testType}File`);
            const file = fileInput.files[0];
            
            if (!file) {
                displayResult(`${testType}Result`, { 
                    status: 'error', 
                    message: 'Please select a file first' 
                });
                return;
            }

            const startTime = Date.now();
            displayResult(`${testType}Result`, { 
                status: 'info', 
                message: `Processing ${file.name}...` 
            });

            try {
                // Simulate file processing (in real app, this would call the actual parsing functions)
                const result = await simulateFileProcessing(file);
                const duration = Date.now() - startTime;
                
                testResults[testType] = {
                    success: result.success,
                    file: file.name,
                    duration,
                    ...result
                };
                
                displayResult(`${testType}Result`, {
                    status: result.success ? 'success' : 'error',
                    message: `${result.success ? '✅ SUCCESS' : '❌ FAILED'} (${duration}ms)`,
                    details: result
                });
                
                updateTestSummary();
                
            } catch (error) {
                const duration = Date.now() - startTime;
                testResults[testType] = {
                    success: false,
                    file: file.name,
                    duration,
                    error: error.message
                };
                
                displayResult(`${testType}Result`, {
                    status: 'error',
                    message: `❌ ERROR (${duration}ms): ${error.message}`
                });
                
                updateTestSummary();
            }
        }

        async function simulateFileProcessing(file) {
            // Simulate processing delay
            await new Promise(resolve => setTimeout(resolve, Math.random() * 1000 + 500));
            
            const extension = file.name.toLowerCase().split('.').pop();
            
            // Basic validation
            if (!['csv', 'xlsx'].includes(extension)) {
                throw new Error('Invalid file format. Only CSV and XLSX files are supported.');
            }
            
            if (file.size > 10 * 1024 * 1024) {
                throw new Error('File too large. Maximum size is 10MB.');
            }
            
            if (file.size === 0) {
                throw new Error('File is empty.');
            }
            
            // Simulate parsing results
            const mockRowCount = Math.floor(Math.random() * 50) + 10;
            const mockValidJobs = Math.floor(mockRowCount * 0.8);
            const mockDuplicates = Math.floor(mockRowCount * 0.1);
            const mockErrors = mockRowCount - mockValidJobs - mockDuplicates;
            
            return {
                success: true,
                fileType: extension.toUpperCase(),
                totalRows: mockRowCount,
                validJobs: mockValidJobs,
                duplicates: mockDuplicates,
                errors: mockErrors,
                headers: ['Job Title', 'Company', 'Location', 'Description'],
                message: `Processed ${mockRowCount} rows: ${mockValidJobs} valid, ${mockDuplicates} duplicates, ${mockErrors} with errors`
            };
        }

        function testErrorHandling(errorType) {
            let result;
            
            switch (errorType) {
                case 'empty':
                    result = {
                        status: 'error',
                        message: '❌ Empty file test: File contains no data rows'
                    };
                    break;
                case 'invalid':
                    result = {
                        status: 'error', 
                        message: '❌ Invalid format test: Unsupported file format (.txt files not allowed)'
                    };
                    break;
                case 'missing':
                    result = {
                        status: 'warning',
                        message: '⚠️ Missing fields test: Jobs with missing titles/companies should be flagged but not blocked entirely'
                    };
                    break;
                default:
                    result = {
                        status: 'error',
                        message: '❌ Unknown error test'
                    };
            }
            
            displayResult('errorResult', result);
            
            testResults[`error_${errorType}`] = {
                success: result.status !== 'error',
                testType: `Error handling: ${errorType}`,
                message: result.message
            };
            
            updateTestSummary();
        }

        function displayResult(elementId, result) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `test-result ${result.status}`;
            
            let content = `<strong>${result.message}</strong><br>`;
            
            if (result.details) {
                content += `<pre>${JSON.stringify(result.details, null, 2)}</pre>`;
            }
            
            element.innerHTML = content;
        }

        function updateTestSummary() {
            const summaryElement = document.getElementById('testSummary');
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(r => r.success).length;
            const failed = total - passed;
            
            let summary = `<strong>Test Results Summary (${total} tests run)</strong><br>`;
            summary += `✅ Passed: ${passed}<br>`;
            summary += `❌ Failed: ${failed}<br><br>`;
            
            if (total > 0) {
                summary += '<strong>Details:</strong><br>';
                Object.entries(testResults).forEach(([test, result]) => {
                    const status = result.success ? '✅' : '❌';
                    summary += `${status} ${test}: ${result.file || result.testType || 'N/A'}`;
                    if (result.duration) {
                        summary += ` (${result.duration}ms)`;
                    }
                    summary += '<br>';
                });
            }
            
            summaryElement.innerHTML = summary;
        }

        // Initialize
        console.log('Job Upload Testing Interface loaded');
        console.log('Use the interface above to test CSV/XLSX upload functionality');
    </script>
</body>
</html>